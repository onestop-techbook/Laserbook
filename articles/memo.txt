メモとして、残す。後で書くかもしれないが、本筋から外れるので削除。

=== レーザダイオードの ON/OFF 制御
いまのところレーザダイオードのON/OFF制御は行っていない。アナログ時計の描画くらいであれば特に必要なく、垂れ流しでも問題無いからである。一方でより複雑な絵を書く場合など、ON/OFFが可能であったほうが便利な場合もある。そこで、本節で、LDのON/OFFについても実装しておく。

ArduinoあるいはESPの端子が直接制御(=ON/OFF)できる電流はせいぜい数十 mAであるが、世の中には大きな電流を制御する必要がある回路は数多く存在する。巨大な電流を直接制御することはできないので、どうするかといえば、「スイッチ」を媒介させて制御する事ができる。メカニカルなスイッチをON/OFFすることができれば、豆電球やモーターといった重い負荷を制御できることは明らかだが、Arduinoにスイッチを動かす「手」はない。そこで使うのがトランジスタである。Arduinoでトランジスタ制御をやっているHP54があったので、参考として挙げておく。

ここで余談だが、トランジスタも大学時代苦手だったなー。電子工学科にあるまじき、かも知れないが、動作は見えないし、何をやってるのかさっぱりわからないし、なんだかよくわからない式やモデルで説明されていて、すごく苦手だった覚えがある。でも、必要に迫られて、というか、趣味で使うにあたっては喜んでやっていると、こんなにもすんなり頭に入るのか！と、今更ながら喜ばしく思う。学びて時に之を習うまた喜ばしからずや、なんてね。

バイポーラトランジスタのベース端子に電流を流すと、その一定倍の電流をコレクタからエミッタに流す事ができる。その増幅割合がhfeである。小信号用としてよく使われる東芝2SC1815であれば、100前後であるらしい。すなわち、ベースに1mA流せば、コレクタからエミッタに100mA流れる、ということである。 200mA流すためには、2mA流せばよく、Arduinoのデジタル出力ピンをON/OFFし て、トランジスタをON/OFFしてやれば、Arduinoで200mAを制御できるというからくりである。

ソフト実装としては、単なるDOを使えばよいので、 

//listnum[onfoo][ON/OFF]{
digitalWrite(pin.high);
digitalWrite(pin,low);
//}

//noindent
だけで実行可能である。

抵抗の調整やトランジスタの選定については、基板実装およびあとの調整の部分で行うことにする。と思って執筆を進めていたが、時間的制約から、トランジスタ制御によるON/OFFの実装は次回回しとなった。ご容赦ください。

こうして、RTCと液晶、DAC、ON/OFF部分の実装が完了した。

改めてスケッチ全体をここに記載する。なお、SinやCosを使っているが、案外重い計算であり、テーブル渡しのほうがよいのではないか？というコメントを頂いたことがある。確かに、使うテーブルは60点(時計の指示点数は文字盤一周で60点なので)にすぎないので他の処理などで計算負荷が高いなら検討の余地がある。
